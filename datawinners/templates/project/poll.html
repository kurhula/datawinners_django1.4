{% extends 'project/tab_navigation.html' %}
{% load compress %}
{% load i18n %}
{% block page_title %} {% trans "Questionnaires - Poll" %} {% endblock %}

{% load dw_tabs %}
{% block navigation %}
    {% activetab "tab_nav" "poll" %}
    {{ block.super }}
{% endblock %}

{% block body %}
    {% activetab "main_nav" "questionnaires" %}
    {{ block.super }}
{% endblock %}

{% block page_css %}
    {{ block.super }}
    <link rel="stylesheet" href="/media/css/plugins/jquery_autocomplete/jquery.autocomplete.css" media="screen">
{% endblock %}

{% block page_scss %}
    <link href="/media/css/scss/section_questionnaire.css" rel="stylesheet"/>
    <link href="/media/css/scss/section_new_create_project.css" rel="stylesheet"/>
    <link href="/media/css/scss/section_questionnaire_preview.css" rel="stylesheet"/>
    <link href="/media/css/scss/smart_phone_instruction.css" rel="stylesheet"/>
    <link href="/media/css/scss/send-sms.css" rel="stylesheet" />
    <link href="/media/css/scss/poll_info.css" rel="stylesheet" />
{% endblock %}


{% block page_js %}
    {{ block.super }}
    <script type="text/javascript">
        var group_ds_count_url = "{% url group_ds_count %}";
        var registered_ds_count_url = "{% url registered_ds_count %}";
        var send_sms_url = "{% url send-sms%}";
        var is_active = "{{ is_active }}";
        var from_date = "{{ from_date }}";
        var to_date = "{{ to_date }}";
        var questionnaire_id = "{{ questionnaire_id }}";
        var languages_list = {{ languages_list|safe }};
        var current_project_language = '{{ current_project_language|safe }}';
        var post_url = '{{ post_url }}';
        var language_page_link = '{{ languages_link }}';
        var is_outgoing_reply_messages_enabled = '{{ project.is_outgoing_sms_replies_enabled }}';
        var questionnaire_name = "{{ questionnaire_name }}";
        var days_active = "{{ days_active }}";
        var number_of_days = '{{ number_of_days }}';
        var get_poll_info_url = "{{ get_poll_info }}";
    </script>
    <script type="text/javascript" src="/media/javascript/ko-binding-extensions.js"></script>
    <script type="text/javascript" src="/media/javascript/dw-ko-validation-extensions.js"></script>
    <script type="text/javascript" src="/media/javascript/project/poll_options.js"></script>
    <script type="text/javascript" src="/media/javascript/entity/send_sms.js"></script>
    <script type="text/javascript" src="/media/javascript/project/project_language.js"></script>
    <script type="text/javascript" src="/media/javascript/common/form_edited_warning_dialog.js"></script>
{% endblock %}


{% block content %}
    <div id="flash-message-section">
        {% include "flash_message.html" %}
    </div>


    <div id="poll_options">
        <div class="margin_left_700">
             <a data-bind="text:send_poll_text, click:send_sms_to_people" > </a>
                <div data-bind="dialog: {autoOpen: false, width: 800, height: 'auto', title:'Send Sms to More People', dialogClass:'no-close'},
                        dialogVisible: show_sms_option, open: send_sms_to_people, dialogContent: show_poll_sms_content">
                </div>
                <div id="show_poll_sms" class="none">
                    <div data-bind="stopBinding: true">
{#                        <div id="poll_section">#}
                            {% include 'send-sms.html' %}
{#                        </div>#}
                    </div>
                </div>
    </div>
        <div id="questionnaire_types" data-bind="accordion: {header: '.questionnaire_type_header', active: selectedPollOption}">
        <div id="poll_status_info" class="questionnaire_type_header">
            <span class="header">{% trans "Poll"%}
                    <span data-bind="text:duration"> </span>
            </span>
        </div>
        <div>
            <span id="poll_success"> </span>
            <p class="italic_grey"> View, edit & send your Survey. </p>
            <div>
                <p>
                    Poll is <strong><span data-bind="text:status"> </span> </strong>now :
                    <a id="deactivate_link" data-bind="text:deactivation, click:deactivate" style="color:#0070ac;" > </a>
                    <a data-bind="text:activation, click:activate" style="color:#0070ac;"> </a>
                </p>
                <p>
                    <br/>
                    <span data-bind="text:duration"> </span>
                    <span>
                        <a data-bind="text:change_days, click:activate" style="color:#0070ac;"> </a>
                    </span>
                </p>
            </div>

            <div data-bind="dialog: {autoOpen: false, width: 475, height: 190, title:'Deactivate Poll', dialogClass:'no-close'},
                    dialogVisible: deactivationDialogVisible, open: deactivate, dialogContent: deactivatePollDialog">
            </div>
            <div data-bind="dialog: {autoOpen: false, width: 475, height: 260, title:'Activate Poll', dialogClass:'no-close'},
                    dialogVisible: activationDialogVisible, open: activate, dialogContent: activatePollDialog">
            </div>

            <div id="deactivate_poll_dialog" class="none">
                <p> {% trans 'Are you sure want to deactivate?' %}</p>
                <div class="float_right margin_top_40">
                    <button id='close_pop' data-bind="click: close_deactivation_popup"> {%trans 'No' %}</button>
                    <button id="yes_button" data-bind="click: deactivate_poll"> {% trans 'Yes' %} </button>
                </div>
            </div>

        </div>
         <div id="automatic_reply"class="questionnaire_type_header">
             <span class="header" >{% trans "Automatic Reply Sms"%}</span>

         </div>
        <div>
            {% include 'project/language.html' %}
        </div>
        {% if project.is_open_survey %}
        {% else %}
             <div id="poll_sms_info" class="questionnaire_type_header">
                 <div data-bind="click: show_poll_info">
                 <span class="header" >{% trans "Poll sent to "%} {{ num_of_recipients }}{% trans " people" %}</span>
                  </div>
             </div>
            <div data-bind="visible:show_poll_table">
               {% include 'project/poll_info_table.html' %}
            </div>
        {% endif %}
    </div>

    <div id="activate_poll_dialog" class="none">
        <p> {% trans 'Select the number of days for the poll to be active:' %}</p>
        <select data-bind="options: active_poll_days, value: number_of_days" class="dropdown_style"></select>
        <span> {% trans 'Days' %} </span><br><br>
        <label>{% trans 'From date:'%} </label>
        <div> <span data-bind="text:from_date_poll"> </span></div>
        <label>{% trans 'To date:'%} </label>
        <div data-bind="text:to_date_poll"></div>
        <div class="float_right margin_top_40">
            <button id='close_pop' data-bind="click: close_activation_popup"> {%trans 'Cancel' %}</button>
            <button data-bind="click: activate_poll, css:{'ui-state-disabled': $root.disable_button}, attr:{disabled:$root.disable_attr}"> {% trans 'Save' %} </button>
        </div>
    </div>
    </div>
{% endblock %}
